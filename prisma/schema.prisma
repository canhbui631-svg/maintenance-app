datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  username  String   @unique
  password  String
  role      String   // "admin" | "team_lead" | "technician" | "guest"
  areas     AreaOnUser[]
  createdAt DateTime @default(now())

  createdTickets  Ticket[] @relation("CreatedTickets")
  assignedTickets Ticket[] @relation("AssignedTickets")  
}

model Area {
  id        Int           @id @default(autoincrement())
  name      String
  users     AreaOnUser[]
  routes    Route[]
  createdAt DateTime      @default(now())
}

model AreaOnUser {
  id     Int  @id @default(autoincrement())
  user   User @relation(fields: [userId], references: [id])
  userId Int
  area   Area @relation(fields: [areaId], references: [id])
  areaId Int
}

model Route {
  id        Int      @id @default(autoincrement())
  name      String
  area      Area     @relation(fields: [areaId], references: [id])
  areaId    Int
  poles     Pole[]
  createdAt DateTime @default(now())
}

model Pole {
  id         Int      @id @default(autoincrement())
  poleNumber String
  route      Route    @relation(fields: [routeId], references: [id])
  routeId    Int
  tickets    Ticket[]
  createdAt  DateTime @default(now())
}

model Ticket {
  id          Int      @id @default(autoincrement())
  createdBy   User     @relation("CreatedTickets", fields: [createdById], references: [id])
  createdById Int
  assignedTo  User?    @relation("AssignedTickets", fields: [assignedToId], references: [id])
  assignedToId Int?
  pole        Pole     @relation(fields: [poleId], references: [id])
  poleId      Int
  status      String   // "new" | "assigned" | "in_progress" | "done" | "approved"
  description String
  createdAt   DateTime @default(now())
}
